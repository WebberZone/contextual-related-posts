jQuery(document).ready(function(e){function t(t,i){var n=i.state().get("selection"),a=[];n.each(function(n){var o=function(t,i){var n,a,o=i.caption;return wp.media.view.settings.captions||delete i.caption,t=wp.media.string.props(t,i),n={id:i.id,post_content:i.description,post_excerpt:o},t.linkUrl&&(n.url=t.linkUrl),"image"===i.type?(a=wp.media.string.image(t),_.each({align:"align",size:"image-size",alt:"image_alt"},function(e,i){t[i]&&(n[e]=t[i])})):"video"===i.type?a=wp.media.string.video(t,i):"audio"===i.type?a=wp.media.string.audio(t,i):(a=wp.media.string.link(t),n.post_title=t.title),e.ajax({type:"POST",dataType:"json",url:ajaxurl,data:{action:"send-attachment-to-editor",nonce:wp.media.view.settings.nonce.sendToEditor,attachment:n,html:a,post_id:wp.media.view.settings.post.id}})}(i.state().display(n).toJSON(),n.toJSON()).done(function(e){!function(e,t){if(e.getSelection().length>0)e.replaceSelection(t);else{var i=e.getDoc(),n=i.getCursor(),a={line:n.line,ch:n.ch};i.replaceRange(t,a)}}(t,e.data)});a.push(o)}),e.when.apply(e,a).always(function(){i.close()})}e(".insert-codemirror-media").on("click",function(i){i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation(),e(this).removeClass("add_media");var n,a=e("#wp-content-editor-container .CodeMirror")[0].CodeMirror;(n=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:!1})).off("insert").on("insert",function(){t(a,n)}),n.open()})});