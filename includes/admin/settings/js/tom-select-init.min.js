!function(t){"use strict";t(document).ready(function(){document.querySelectorAll(".ts_autocomplete").forEach(function(e){const a=e.getAttribute("data-wp-prefix")||"WZ",o=window[`${a}TomSelectSettings`]||WZTomSelectSettings,n=e.getAttribute("data-wp-action")||o.action,r=e.getAttribute("data-wp-nonce")||o.nonce,i=e.getAttribute("data-wp-endpoint")||o.endpoint,s=o.forms,c=o.tags,l=o.custom_fields,u=o.strings,d="forms"===i?s:"tags"===i?c:"custom_fields"===i?l:[];if(!d||!Array.isArray(d))return void console.error("Invalid options for endpoint:",i);const p=d.map(t=>({value:t.id,text:t.name})),v=e.value.split(",").map(t=>t.trim()).filter(Boolean);if(("category"===i||"post_tag"===i||i.includes("tax"))&&v.length>0){const t=v.map(t=>{const e=t.match(/^(.*)\s+\(.*:\d+\)$/);return{value:t,text:e?e[1]:t}}),e=[...p];t.forEach(t=>{e.some(e=>e.value===t.value)||e.push(t)}),p.length=0,p.push(...e)}"category"!==i&&"post_tag"!==i&&!i.includes("tax")&&v.length>0&&v.forEach(t=>{p.some(e=>e.value===t)||p.push({value:t,text:t})});let g={};const m=e.getAttribute("data-ts-config");if(m)try{g=JSON.parse(m)}catch(t){console.error("Error parsing custom config:",m,t)}const f={...{plugins:["dropdown_input","clear_button","remove_button"],valueField:"value",labelField:"text",searchField:["text","value"],options:p,items:v,persist:!0,createOnBlur:!1,create:!1,render:{no_results:(t,e)=>`<div class="no-results">${u.no_results.replace("%s",e(t.input))}</div>`,option:(t,e)=>"category"===i||"post_tag"===i||i.includes("tax")||t.text===t.value?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`,item:(t,e)=>"category"===i||"post_tag"===i||i.includes("tax")||t.text===t.value?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`},load:function(e,a){e.length?t.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:n,nonce:r,q:e,endpoint:i},error:function(){a()},success:function(t){t.success&&Array.isArray(t.data)?a(t.data):a()}}):a()}},...g};try{new TomSelect(e,f)}catch(t){console.error("Tom Select initialization error:",t)}})})}(jQuery);